"use strict";(self.webpackChunksakai_ng=self.webpackChunksakai_ng||[]).push([[3280],{3280:(T,C,s)=>{s.r(C),s.d(C,{InvalidStateDemoModule:()=>ce});var x=s(6814),u=s(95),h=s(2507),Z=s(8504),k=s(6306),D=s(5219),e=s(4769),I=s(7744),w=s(8814),l=s(9862),p=s(2039),r=s(7327),m=s(7161);function g(n,d){if(1&n&&(e.TgZ(0,"div",29)(1,"div"),e._uU(2),e.qZA()()),2&n){const c=d.$implicit;e.xp6(2),e.Oqu(c.device_name)}}function v(n,d){if(1&n&&(e.TgZ(0,"div",30),e._uU(1),e.qZA()),2&n){const c=e.oxw();e.xp6(1),e.AsE(" Last Updated: ",c.EnergyData.date," ",c.EnergyData.time," ")}}function f(n,d){1&n&&(e.TgZ(0,"div",30),e._uU(1," Select a device "),e.qZA())}function y(n,d){1&n&&(e.TgZ(0,"div",31),e._UZ(1,"i",32),e.TgZ(2,"span",33),e._uU(3,"Loading devices..."),e.qZA()())}function M(n,d){1&n&&(e.TgZ(0,"div",34),e._UZ(1,"p-message",35),e.qZA())}function A(n,d){1&n&&e._UZ(0,"div",36)}function P(n,d){1&n&&e._UZ(0,"div",37)}function U(n,d){1&n&&e._UZ(0,"div",36)}function E(n,d){1&n&&e._UZ(0,"div",38)}function N(n,d){1&n&&e._UZ(0,"div",36)}function J(n,d){1&n&&e._UZ(0,"div",39)}function q(n,d){1&n&&e._UZ(0,"div",36)}function Y(n,d){1&n&&e._UZ(0,"div",40)}function L(n,d){1&n&&e._UZ(0,"div",36)}function Q(n,d){1&n&&e._UZ(0,"div",41)}function F(n,d){1&n&&e._UZ(0,"div",36)}function z(n,d){1&n&&e._UZ(0,"div",42)}function W(n,d){1&n&&e._UZ(0,"div",36)}function $(n,d){1&n&&e._UZ(0,"div",43)}function B(n,d){1&n&&e._UZ(0,"div",36)}function R(n,d){1&n&&e._UZ(0,"div",44)}const j=function(){return{width:"100%"}},K=function(){return{standalone:!0}};let G=(()=>{var n;class d{constructor(i,t,o,a,_,b,S,re){this.router=i,this.countryService=t,this.api=o,this.http=a,this.messageService=_,this.websocketService=b,this.fb=S,this.cdr=re,this.led1=!1,this.led2=!0,this.led3=!0,this.led4=!1,this.led5=!1,this.led6=!0,this.led7=!1,this.led8=!1,this.d1StatusDetails=null,this.d1Loading=!1,this.filteredDealer=[],this.dealer=[],this.spinner=!1,this.client_id=+localStorage.getItem("c_id"),this.loginType=localStorage.getItem("loginType"),this.EnergyData={}}ngOnInit(){this.getDeviceList()}ngOnDestroy(){this.websocketSubscription&&this.websocketSubscription.unsubscribe(),this.subscription&&this.subscription.unsubscribe()}getDeviceList(){console.log("Fetching device list..."),this.spinner=!0,this.api.call_api(1,"client/devices/list",{client_id:this.client_id}).subscribe(t=>{console.log("Device list response:",t),this.spinner=!1,t&&"success"===t.status&&t.data?(this.dealer=t.data.map(o=>({id:o.device_id,device_name:o.device,device_type:o.device_type,meter_type:o.meter_type})),console.log("Devices loaded:",this.dealer),this.dealer.length>0?(this.selectedDealer=this.dealer[0],console.log("Selected device:",this.selectedDealer),this.connectToWebSocket(this.client_id,this.selectedDealer.id,this.selectedDealer.device_name)):(console.warn("No devices found for this client"),this.messageService.add({severity:"warn",summary:"No Devices",detail:"No devices found for your account."}))):(console.error("Unexpected response format:",t),this.messageService.add({severity:"error",summary:"Error",detail:t?.message||"Failed to load devices. Invalid response format."}))},t=>{console.error("Error fetching devices:",t),this.spinner=!1,this.messageService.add({severity:"error",summary:"Error",detail:t.error?.message||"Failed to load devices. Please try again."})})}updateDIStatus(i){if(console.log("Raw DI status received:",i),!i||"string"!=typeof i)return void console.error("Invalid DI status:",i);const t=i.padEnd(8,"0");console.log("Padded DI status:",t),this.led1="1"===t[0],this.led2="1"===t[1],this.led3="1"===t[2],this.led4="1"===t[3],this.led5="1"===t[4],this.led6="1"===t[5],this.led7="1"===t[6],this.led8="1"===t[7],console.log("Updated LED states:",{diStatus:i,paddedStatus:t,led1:this.led1,led2:this.led2,led3:this.led3,led4:this.led4,led5:this.led5,led6:this.led6,led7:this.led7,led8:this.led8}),this.syncDOStates(),this.updateCheckboxStates(),setTimeout(()=>{console.log("Forcing change detection..."),this.cdr.detectChanges()})}updateCheckboxStates(){document.querySelectorAll(".switch-input").forEach((t,o)=>{t.checked=this[`led${o+1}`]})}syncDOStates(){if(!this.selectedDealer||!this.selectedDealer.id)return;const i=[];for(let t=0;t<8;t++)i.push(this.api.call_api(1,"mqtt/publish_io",{do_no:t+1,do_status:this[`led${t+1}`]?1:0,device_id:this.selectedDealer.id,device:this.selectedDealer.device_name}));Promise.all(i).then(()=>{console.log("All DO states synced with DI states"),this.updateCheckboxStates()}).catch(t=>console.error("Error syncing DO states:",t))}fetchDIStatus(i,t){const o={client_id:this.client_id,device_id:i,device:t};return console.log("Fetching DI status with payload:",o),this.api.call_api(1,"device/ws_data_ems",o).pipe((0,k.K)(a=>(console.error("API Error:",a),0===a.status&&console.error("CORS issue detected. Please ensure the API server allows requests from this origin."),(0,Z._)(a))))}connectToWebSocket(i,t,o){console.log(`Connecting to device ${t} (${o})`),this.spinner=!0,this.fetchDIStatus(t,o)?.subscribe(a=>{console.log("Initial device status response:",a);const _=new Date;this.EnergyData={date:_.toLocaleDateString(),time:_.toLocaleTimeString()},a&&a.data?(console.log("API Response data:",a.data),a.data.di?(console.log("Found DI status in response:",a.data.di),this.updateDIStatus(a.data.di)):console.warn("No DI status found in response")):console.warn("Invalid API response format:",a),this.spinner=!1},a=>{console.error("Error fetching device status:",a),401===a.status&&(console.error("Authentication failed - redirecting to login"),this.router.navigate(["/"])),this.messageService.add({severity:"error",summary:"Connection Error",detail:a.error?.message||"Failed to fetch device status",life:3e3}),this.spinner=!1})}fetchDIStatusOnPublish(){this.selectedDealer&&this.fetchDIStatus(this.selectedDealer.id,this.selectedDealer.device_name).subscribe(i=>{if(i&&i.data&&i.data.di){this.updateDIStatus(i.data.di);const t=new Date;this.EnergyData={date:t.toLocaleDateString(),time:t.toLocaleTimeString()}}},i=>{console.error("Error fetching device status after publish:",i)})}setDevice(){console.log("Device selected:",this.selectedDealer),this.selectedDealer?this.connectToWebSocket(this.client_id,this.selectedDealer.id,this.selectedDealer.device_name):console.error("No device selected")}filterDealer(i){let t=[],o=i.query;this.dealer&&(t=this.dealer.filter(a=>a.device_name.toLowerCase().includes(o.toLowerCase()))),this.filteredDealer=t}updateDIState(i,t){this.updateDeviceState(i,t?1:0)}onCheckbox1Change(i){this.updateDIState(1,i.target.checked)}onCheckbox2Change(i){this.updateDIState(2,i.target.checked)}onCheckbox3Change(i){this.updateDIState(3,i.target.checked)}onCheckbox4Change(i){this.updateDIState(4,i.target.checked)}onCheckbox5Change(i){this.updateDIState(5,i.target.checked)}onCheckbox6Change(i){this.updateDIState(6,i.target.checked)}onCheckbox7Change(i){this.updateDIState(7,i.target.checked)}onCheckbox8Change(i){this.updateDIState(8,i.target.checked)}getD1StatusDetails(i,t){this.d1Loading=!0,this.fetchDIStatus(i,t).subscribe({next:o=>{console.log("D1 Status Details:",o),this.d1StatusDetails=o?.data||null,this.d1StatusDetails?.di&&this.updateDIStatus(this.d1StatusDetails.di),this.d1Loading=!1},error:o=>{console.error("Error fetching D1 status:",o),this.d1Loading=!1,this.messageService.add({severity:"error",summary:"Error",detail:o.error?.message||"Failed to fetch D1 status",life:3e3}),401===o.status&&this.router.navigate(["/"])}})}updateDeviceState(i,t){if(!this.selectedDealer?.id)return void this.messageService.add({severity:"warn",summary:"No Device Selected",detail:"Please select a device first",life:3e3});const o={do_no:i,do_status:t,device_id:this.selectedDealer.id,device:this.selectedDealer.device_name};this.spinner=!0,this.spinner=!0,this.api.call_api(1,"mqtt/publish_io",o).subscribe({next:a=>{if(console.log("Publish API response:",a),this.spinner=!1,this[`led${i}`]=1===a?.data?.do_status||"1"===a?.data?.do_status,this.cdr.detectChanges(),a?.data?.di)this.updateDIStatus(a.data.di);else if(null===a?.data?.di){this[`led${i}`]=!1;const S=document.querySelectorAll(".switch-input")[i-1];S&&(S.checked=!1),this.cdr.detectChanges()}else setTimeout(()=>{this.fetchDIStatusOnPublish()},2e3)},error:a=>{if(console.error("Error in publish API:",a),this.spinner=!1,401===a.status)return void this.router.navigate(["/"]);this.messageService.add({severity:"error",summary:"Error",detail:a.error?.message||"Failed to update device state",life:3e3});const b=document.querySelectorAll(".switch-input")[i-1];b&&(b.checked=0===t,this[`led${i}`]=1===t,this.cdr.detectChanges())}})}}return(n=d).\u0275fac=function(i){return new(i||n)(e.Y36(h.F0),e.Y36(I.T),e.Y36(w.s),e.Y36(l.eN),e.Y36(D.ez),e.Y36(p.i),e.Y36(u.qu),e.Y36(e.sBO))},n.\u0275cmp=e.Xpm({type:n,selectors:[["ng-component"]],features:[e._Bn([D.ez,D.YP])],decls:131,vars:31,consts:[[1,"card",2,"margin-bottom","1rem"],[1,"p-fluid","grid"],[1,"col-12"],[1,"device-selector"],[2,"display","flex","justify-content","space-between","align-items","center","gap","1rem"],["placeholder","Select a device","field","device_name",3,"ngModel","ngModelOptions","suggestions","dropdown","minLength","forceSelection","scrollHeight","ngModelChange","onSelect","completeMethod"],["pTemplate","item"],["class","last-updated",4,"ngIf"],["class","p-d-flex p-ai-center p-mt-2",4,"ngIf"],["class","p-mt-2",4,"ngIf"],[1,"card"],[1,"grid","p-fluid"],[2,"text-align","center"],[1,"col-12","lg:col-12","xl:col-12"],["class","null led",4,"ngIf"],["class","green led",4,"ngIf"],["class","red led",4,"ngIf"],["class","yellow led",4,"ngIf"],["class","pink led",4,"ngIf"],["class","merun led",4,"ngIf"],["class","orange led",4,"ngIf"],["class","sky led",4,"ngIf"],["class","blue led",4,"ngIf"],[1,"col-12","md:col-1",2,"text-align","center"],[1,"field"],[1,"switch","switch-green"],["type","checkbox",1,"switch-input",3,"change"],["data-on","On","data-off","Off",1,"switch-label"],[1,"switch-handle"],[1,"p-d-flex","p-ai-center"],[1,"last-updated"],[1,"p-d-flex","p-ai-center","p-mt-2"],[1,"pi","pi-spin","pi-spinner",2,"font-size","1.5rem"],[1,"p-ml-2"],[1,"p-mt-2"],["severity","warn","text","No devices found. Please check your connection."],[1,"null","led"],[1,"green","led"],[1,"red","led"],[1,"yellow","led"],[1,"pink","led"],[1,"merun","led"],[1,"orange","led"],[1,"sky","led"],[1,"blue","led"]],template:function(i,t){1&i&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"p-autoComplete",5),e.NdJ("ngModelChange",function(a){return t.selectedDealer=a})("onSelect",function(){return t.setDevice()})("completeMethod",function(a){return t.filterDealer(a)}),e.YNc(6,g,3,1,"ng-template",6),e.qZA(),e.YNc(7,v,2,2,"div",7),e.YNc(8,f,2,0,"div",7),e.qZA(),e.YNc(9,y,4,0,"div",8),e.YNc(10,M,2,0,"div",9),e.qZA()()()(),e.TgZ(11,"div",10)(12,"h5"),e._uU(13,"Input"),e.qZA(),e.TgZ(14,"div",11)(15,"div",12)(16,"div",13)(17,"h4"),e._uU(18,"DI 1"),e.qZA(),e.YNc(19,A,1,0,"div",14),e.YNc(20,P,1,0,"div",15),e.qZA()(),e.TgZ(21,"div",12)(22,"div",13)(23,"h4"),e._uU(24,"DI 2"),e.qZA(),e.YNc(25,U,1,0,"div",14),e.YNc(26,E,1,0,"div",16),e.qZA()(),e.TgZ(27,"div",12)(28,"div",13)(29,"h4"),e._uU(30,"DI 3"),e.qZA(),e.YNc(31,N,1,0,"div",14),e.YNc(32,J,1,0,"div",17),e.qZA()(),e.TgZ(33,"div",12)(34,"div",13)(35,"h4"),e._uU(36,"DI 4"),e.qZA(),e.YNc(37,q,1,0,"div",14),e.YNc(38,Y,1,0,"div",18),e.qZA()(),e.TgZ(39,"div",12)(40,"div",13)(41,"h4"),e._uU(42,"DI 5"),e.qZA(),e.YNc(43,L,1,0,"div",14),e.YNc(44,Q,1,0,"div",19),e.qZA()(),e.TgZ(45,"div",12)(46,"div",13)(47,"h4"),e._uU(48,"DI 6"),e.qZA(),e.YNc(49,F,1,0,"div",14),e.YNc(50,z,1,0,"div",20),e.qZA()(),e.TgZ(51,"div",12)(52,"div",13)(53,"h4"),e._uU(54,"DI 7"),e.qZA(),e.YNc(55,W,1,0,"div",14),e.YNc(56,$,1,0,"div",21),e.qZA()(),e.TgZ(57,"div",12)(58,"div",13)(59,"h4"),e._uU(60,"DI 8"),e.qZA(),e.YNc(61,B,1,0,"div",14),e.YNc(62,R,1,0,"div",22),e.qZA()()()(),e.TgZ(63,"div",10)(64,"h5"),e._uU(65,"Output"),e.qZA(),e.TgZ(66,"div",11)(67,"div",23)(68,"div",24)(69,"label",25)(70,"input",26),e.NdJ("change",function(a){return t.onCheckbox1Change(a)}),e.qZA(),e._UZ(71,"span",27)(72,"span",28),e.qZA()(),e.TgZ(73,"label"),e._uU(74,"DO 1"),e.qZA()(),e.TgZ(75,"div",23)(76,"div",24)(77,"label",25)(78,"input",26),e.NdJ("change",function(a){return t.onCheckbox2Change(a)}),e.qZA(),e._UZ(79,"span",27)(80,"span",28),e.qZA()(),e.TgZ(81,"label"),e._uU(82,"DO 2"),e.qZA()(),e.TgZ(83,"div",23)(84,"div",24)(85,"label",25)(86,"input",26),e.NdJ("change",function(a){return t.onCheckbox3Change(a)}),e.qZA(),e._UZ(87,"span",27)(88,"span",28),e.qZA()(),e.TgZ(89,"label"),e._uU(90,"DO 3"),e.qZA()(),e.TgZ(91,"div",23)(92,"div",24)(93,"label",25)(94,"input",26),e.NdJ("change",function(a){return t.onCheckbox4Change(a)}),e.qZA(),e._UZ(95,"span",27)(96,"span",28),e.qZA()(),e.TgZ(97,"label"),e._uU(98,"DO 4"),e.qZA()(),e.TgZ(99,"div",23)(100,"div",24)(101,"label",25)(102,"input",26),e.NdJ("change",function(a){return t.onCheckbox5Change(a)}),e.qZA(),e._UZ(103,"span",27)(104,"span",28),e.qZA()(),e.TgZ(105,"label"),e._uU(106,"DO 5"),e.qZA()(),e.TgZ(107,"div",23)(108,"div",24)(109,"label",25)(110,"input",26),e.NdJ("change",function(a){return t.onCheckbox6Change(a)}),e.qZA(),e._UZ(111,"span",27)(112,"span",28),e.qZA()(),e.TgZ(113,"label"),e._uU(114,"DO 6"),e.qZA()(),e.TgZ(115,"div",23)(116,"div",24)(117,"label",25)(118,"input",26),e.NdJ("change",function(a){return t.onCheckbox7Change(a)}),e.qZA(),e._UZ(119,"span",27)(120,"span",28),e.qZA()(),e.TgZ(121,"label"),e._uU(122,"DO 7"),e.qZA()(),e.TgZ(123,"div",23)(124,"div",24)(125,"label",25)(126,"input",26),e.NdJ("change",function(a){return t.onCheckbox8Change(a)}),e.qZA(),e._UZ(127,"span",27)(128,"span",28),e.qZA()(),e.TgZ(129,"label"),e._uU(130,"DO 8"),e.qZA()()()()),2&i&&(e.xp6(5),e.Akn(e.DdM(29,j)),e.Q6J("ngModel",t.selectedDealer)("ngModelOptions",e.DdM(30,K))("suggestions",t.filteredDealer)("dropdown",!0)("minLength",1)("forceSelection",!1)("scrollHeight",250),e.xp6(2),e.Q6J("ngIf",(null==t.EnergyData?null:t.EnergyData.date)&&(null==t.EnergyData?null:t.EnergyData.time)),e.xp6(1),e.Q6J("ngIf",!(null!=t.EnergyData&&t.EnergyData.date)),e.xp6(1),e.Q6J("ngIf",t.spinner),e.xp6(1),e.Q6J("ngIf",0===t.dealer.length&&!t.spinner),e.xp6(9),e.Q6J("ngIf",!t.led1),e.xp6(1),e.Q6J("ngIf",t.led1),e.xp6(5),e.Q6J("ngIf",!t.led2),e.xp6(1),e.Q6J("ngIf",t.led2),e.xp6(5),e.Q6J("ngIf",!t.led3),e.xp6(1),e.Q6J("ngIf",t.led3),e.xp6(5),e.Q6J("ngIf",!t.led4),e.xp6(1),e.Q6J("ngIf",t.led4),e.xp6(5),e.Q6J("ngIf",!t.led5),e.xp6(1),e.Q6J("ngIf",t.led5),e.xp6(5),e.Q6J("ngIf",!t.led6),e.xp6(1),e.Q6J("ngIf",t.led6),e.xp6(5),e.Q6J("ngIf",!t.led7),e.xp6(1),e.Q6J("ngIf",t.led7),e.xp6(5),e.Q6J("ngIf",!t.led8),e.xp6(1),e.Q6J("ngIf",t.led8))},dependencies:[x.O5,u.JJ,u.On,r.Qc,D.jx,m.q],styles:['.device-selector[_ngcontent-%COMP%]{width:100%;margin-bottom:1rem;padding:1rem}.device-selector[_ngcontent-%COMP%]   .p-autocomplete[_ngcontent-%COMP%]{width:100%;max-width:400px;min-width:250px}.device-selector[_ngcontent-%COMP%]   .p-autocomplete[_ngcontent-%COMP%]   .p-autocomplete-input[_ngcontent-%COMP%]{width:100%;padding:.5rem;border:1px solid #ced4da;border-radius:4px;font-size:1rem}.device-selector[_ngcontent-%COMP%]   .p-autocomplete[_ngcontent-%COMP%]   .p-autocomplete-panel[_ngcontent-%COMP%]{z-index:1000}.device-selector[_ngcontent-%COMP%]   .last-updated[_ngcontent-%COMP%]{background-color:#f8f9fa;padding:.5rem 1rem;border-radius:4px;font-size:.875rem;color:#495057;box-shadow:0 2px 4px #0000001a;margin-left:1rem;white-space:nowrap}.switch[_ngcontent-%COMP%]{position:relative;display:inline-block;vertical-align:top;width:56px;height:20px;padding:3px;background-color:#fff;border-radius:18px;box-shadow:inset 0 -1px #fff,inset 0 1px 1px #0000000d;cursor:pointer;background-image:linear-gradient(to bottom,#eeeeee,white 25px)}.switch-input[_ngcontent-%COMP%]{position:absolute;top:0;left:0;opacity:0}.switch-label[_ngcontent-%COMP%]{position:relative;display:block;height:inherit;font-size:10px;text-transform:uppercase;background:#eceeef;border-radius:inherit;box-shadow:inset 0 1px 2px #0000001f,inset 0 0 2px #00000026;transition:.15s ease-out;transition-property:opacity background}.switch-label[_ngcontent-%COMP%]:before, .switch-label[_ngcontent-%COMP%]:after{position:absolute;top:50%;margin-top:-.5em;line-height:1;transition:inherit}.switch-label[_ngcontent-%COMP%]:before{content:attr(data-off);right:11px;color:#aaa;text-shadow:0 1px rgba(255,255,255,.5)}.switch-label[_ngcontent-%COMP%]:after{content:attr(data-on);left:11px;color:#fff;text-shadow:0 1px rgba(0,0,0,.2);opacity:0}.switch-input[_ngcontent-%COMP%]:checked ~ .switch-label[_ngcontent-%COMP%]{background:#47a8d8;box-shadow:inset 0 1px 2px #00000026,inset 0 0 3px #0003}.switch-input[_ngcontent-%COMP%]:checked ~ .switch-label[_ngcontent-%COMP%]:before{opacity:0}.switch-input[_ngcontent-%COMP%]:checked ~ .switch-label[_ngcontent-%COMP%]:after{opacity:1}.switch-handle[_ngcontent-%COMP%]{position:absolute;top:4px;left:4px;width:18px;height:18px;background:white;border-radius:10px;box-shadow:1px 1px 5px #0003;background-image:linear-gradient(to bottom,white 40%,#f0f0f0);transition:left .15s ease-out}.switch-handle[_ngcontent-%COMP%]:before{content:"";position:absolute;top:50%;left:50%;margin:-6px 0 0 -6px;width:12px;height:12px;background:#f9f9f9;border-radius:6px;box-shadow:inset 0 1px #00000005;background-image:linear-gradient(to bottom,#eeeeee,white)}.switch-input[_ngcontent-%COMP%]:checked ~ .switch-handle[_ngcontent-%COMP%]{left:40px;box-shadow:-1px 1px 5px #0003}.switch-green[_ngcontent-%COMP%] > .switch-input[_ngcontent-%COMP%]:checked ~ .switch-label[_ngcontent-%COMP%]{background:#4fb845}.null[_ngcontent-%COMP%]{background-image:-webkit-linear-gradient(top,#8c8c8c 0%,#7c7d7c 50%,#7e7e7e 100%)}.green[_ngcontent-%COMP%]{background-image:-webkit-linear-gradient(top,#13fB04 0%,#58e343 50%,#ADED99 100%)}.orange[_ngcontent-%COMP%]{background-image:-webkit-linear-gradient(top,#f9a004 0%,#e0ac45 50%,#ead698 100%)}.yellow[_ngcontent-%COMP%]{background-image:-webkit-linear-gradient(top,#dafb04 0%,#d8e343 50%,#eaed99 100%)}.red[_ngcontent-%COMP%]{background-image:-webkit-linear-gradient(top,#fb1304 0%,#e35843 50%,#edad99 100%)}.blue[_ngcontent-%COMP%]{background-image:-webkit-linear-gradient(top,#0442fb 0%,#5043e3 50%,#a099ed 100%)}.pink[_ngcontent-%COMP%]{background-image:-webkit-linear-gradient(top,#fb04e2 0%,#e343e3 50%,#ed99e2 100%)}.sky[_ngcontent-%COMP%]{background-image:-webkit-linear-gradient(top,#04eafb 0%,#43d3e3 50%,#99e5ed 100%)}.merun[_ngcontent-%COMP%]{background-image:-webkit-linear-gradient(top,#ad04fb 0%,#9643e3 50%,#ca99ed 100%)}.led[_ngcontent-%COMP%]{border-radius:5px;width:10px;height:10px;box-shadow:0 0 3px #000;zoom:5;margin:5px 5px 5px 17%}.led[_ngcontent-%COMP%]:after{display:block;content:"";margin-left:1px;margin-right:1px;width:8px;height:6px;-webkit-border-top-right-radius:4px 3px;-webkit-border-top-left-radius:4px 3px;-webkit-border-bottom-right-radius:4px 3px;-webkit-border-bottom-left-radius:4px 3px;background-image:-webkit-linear-gradient(top,rgba(255,255,255,.8) 0%,rgba(255,255,255,.2) 100%)}']}),d})(),H=(()=>{var n;class d{}return(n=d).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[h.Bz.forChild([{path:"",component:G}]),h.Bz]}),d})();var X=s(6760),V=s(1480),ee=s(3965),te=s(9663),ne=s(5167),ie=s(8062),ae=s(4055),oe=s(6218),se=s(3714),de=s(1423),O=s(7680),le=s(9502);let ce=(()=>{var n;class d{}return(n=d).\u0275fac=function(i){return new(i||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[x.ez,u.u5,H,r.WN,X._8,V.Gg,ee.kW,te.zz,ne.L$,ie.XH,ae.q4,de.gz,oe.A,se.j,O.L,m.O,le.$,O.L]}),d})()},2039:(T,C,s)=>{s.d(C,{i:()=>D});var x=s(5592),u=s(9862),h=s(4769),Z=s(2507),k=s(8814);let D=(()=>{var e;class I{constructor(l,p,r){this.router=l,this.api=p,this.http=r,this.socketStatus=!1,this.baseURL="wss://msapi.iotblitz.com/api/ws_routes/ws/EMS/"}connect(l,p,r){return this.client_id=l,this.device_id=p,this.device=r,this.socket=new WebSocket(this.baseURL+`${l}/${p}/${r}`),new x.y(g=>(this.socket.onopen=v=>{this.socketStatus=!0,console.log("WebSocket connected"),this.callData()},this.socket.onmessage=v=>{try{const f=JSON.parse(v.data);g.next(f),console.log(f)}catch(f){g.error(f),console.log(f)}},this.socket.onerror=v=>{g.error(v),console.log(v)},this.socket.onclose=()=>{console.log("WebSocket closed"),g.complete(),this.socketStatus=!1},()=>{this.socket.close()}))}sendMessage(l){this.socket.send(JSON.stringify(l))}callData(){if(this.socketStatus){const l={device:this.device,device_id:this.device_id,client_id:this.client_id},p=localStorage.getItem("token"),r=(new u.WM).set("Authorization",`Bearer ${p}`);this.http.post(this.api.baseUrl+"/device/ws_data_ems",l,{headers:r}).subscribe(m=>{this.resData=m.data,console.log(m)})}}}return(e=I).\u0275fac=function(l){return new(l||e)(h.LFG(Z.F0),h.LFG(k.s),h.LFG(u.eN))},e.\u0275prov=h.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),I})()}}]);